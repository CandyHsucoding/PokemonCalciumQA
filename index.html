<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¶å¯å¤¢æˆé•·çŸ¥è­˜å¤§æŒ‘æˆ°</title>
    <!-- è¼‰å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¨­å®š Tailwind CSS é…ç½®ï¼Œç¢ºä¿ä½¿ç”¨ Inter å­—é«” -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans TC', 'sans-serif'],
                    },
                },
            }
        }
    </script>
    <!-- è¼‰å…¥ Tone.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        /* ç¢ºä¿å­—é«”åœ¨ä¸åŒç³»çµ±ä¸‹çš„ä¸€è‡´æ€§ */
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>

<div id="app">
    <!-- æ‡‰ç”¨ç¨‹å¼å…§å®¹å°‡ç”± JavaScript æ¸²æŸ“åˆ°é€™è£¡ -->
</div>

<script>
    // --- æ ¸å¿ƒæ‡‰ç”¨ç¨‹å¼é‚è¼¯ (ç´” JavaScript) ---

    // éŠæˆ²ç‹€æ…‹
    const state = {
        currentQuestions: [],
        currentQIndex: 0,
        score: 0,
        gameState: 'start', // 'start', 'playing', 'answer', 'end'
        selectedAnswer: null,
        isCorrect: null,
        timer: 0,
        intervalId: null,
        correctSynth: null,
        wrongSynth: null,
        NUM_QUESTIONS: 10
    };

    // --- å°ˆå±¬é¡Œåº«ï¼šçµåˆå¯¶å¯å¤¢å…ƒç´  (é«˜éˆ£èˆ‡å¥åº·ä¸»é¡Œ) ---
    const quizData = [
        // Q1-Q5: æ ¸å¿ƒæˆé•·çŸ¥è­˜ï¼Œä½¿ç”¨å¯¶å¯å¤¢æ¯”å–»
        { id: 1, question: "å¯¶å¯å¤¢è¦è®“ç‰ çš„éª¨éª¼åƒå¤§å²©è›‡ï¼ˆOnixï¼‰ä¸€æ¨£å …ç¡¬ï¼Œå¿…é ˆåŒæ™‚æœç”¨å“ªå…©ç¨®ã€Œè¶…ç´šèƒ½é‡æ–¹å¡Šã€ï¼Ÿ", options: ["ç³–æœå’Œæ±½æ°´", "éˆ£è³ªå’Œç¶­ç”Ÿç´  D", "è„‚è‚ªå’Œé¹½", "è›‹ç™½è³ªå’Œæ°´"], answer: "éˆ£è³ªå’Œç¶­ç”Ÿç´  D", explanation: "éˆ£è³ªæ˜¯éª¨éª¼çš„åŸºçŸ³ï¼Œç¶­ç”Ÿç´  D å°±åƒè¨“ç·´å¸«ï¼Œèƒ½å¹«åŠ©èº«é«”å¸æ”¶éˆ£è³ªï¼Œæ˜¯é€²åŒ–å¼·å£¯éª¨éª¼çš„å¿…å‚™çµ„åˆï¼", category: "é«˜éˆ£ç‡Ÿé¤Š" },
        { id: 2, question: "å“ªä¸€ç¨®è¡Œç‚ºèƒ½è®“ä½ çš„èº«é«”åƒå¤ªé™½ä¼Šå¸ƒï¼ˆEspeonï¼‰ä¸€æ¨£ï¼Œåˆ©ç”¨é™½å…‰è‡ªè¡Œè£½é€ å‡ºèƒ½å¹«åŠ©å¸æ”¶éˆ£è³ªçš„ã€Œé€²åŒ–å‚¬åŒ–åŠ‘ã€ï¼Ÿ", options: ["æ•´å¤©å¾…åœ¨å®¤å…§", "æ¯å¤©é©åº¦æ›¬å¤ªé™½", "æ™šä¸Šä¸ç¡è¦º", "å¤šå–å’–å•¡"], answer: "æ¯å¤©é©åº¦æ›¬å¤ªé™½", explanation: "æ›¬å¤ªé™½èƒ½å•Ÿå‹•èº«é«”çš„ç‰¹æ®Šèƒ½åŠ›ï¼Œå…è²»åˆæˆç¶­ç”Ÿç´  Dï¼Œé€™å°éˆ£è³ªå¸æ”¶éå¸¸é‡è¦ï¼", category: "ç”Ÿæ´»" },
        { id: 3, question: "æƒ³è®“å¯¶å¯å¤¢çš„è‚Œè‚‰åƒæ€ªåŠ›ï¼ˆMachampï¼‰ä¸€æ¨£å¼·å£¯æœ‰åŠ›ï¼Œç‰ éœ€è¦å¤§é‡æ”å–å“ªç¨®ã€ŒåŠ›é‡ç©æœ¨ã€ï¼Ÿ", options: ["åªæœ‰ç³–", "è›‹ç™½è³ªï¼ˆå¦‚è›‹ã€é­šã€è±†è…ï¼‰", "åªæœ‰æ°´", "æ±½æ°´"], answer: "è›‹ç™½è³ªï¼ˆå¦‚è›‹ã€é­šã€è±†è…ï¼‰", explanation: "è›‹ç™½è³ªæ˜¯è‚Œè‚‰ä¿®å¾©å’Œæˆé•·çš„åŸºç¤ã€‚æ²’æœ‰è¶³å¤ çš„ç©æœ¨ï¼Œå¯¶å¯å¤¢ç„¡æ³•ç·´æˆæ€ªåŠ›çš„è‚Œè‚‰ã€‚", category: "ç‡Ÿé¤Š" },
        { id: 4, question: "å“ªç¨®é‹å‹•èƒ½çµ¦äºˆéª¨éª¼é©ç•¶çš„ã€Œé€²åŒ–åˆºæ¿€ã€ï¼Œè®“ç‰ å€‘é•·å¾—æ›´é«˜æ›´å¿«ï¼Ÿ", options: ["éœæ­¢ä¸å‹•", "æœ‰è·³èºã€è·‘å‹•çš„æ´»å‹• (å¦‚è·³ç¹©ã€ç±ƒçƒ)", "èˆ‰å¾ˆé‡çš„æ±è¥¿", "é•·æ™‚é–“èººè‘—"], answer: "æœ‰è·³èºã€è·‘å‹•çš„æ´»å‹• (å¦‚è·³ç¹©ã€ç±ƒçƒ)", explanation: "éª¨éª¼éœ€è¦é©åº¦çš„è¡æ“Šæ‰èƒ½å¾—åˆ°åˆºæ¿€ï¼Œé€™å°±åƒå¯¶å¯å¤¢æˆ°é¬¥ä¸€æ¨£ï¼Œæˆ°é¬¥ï¼ˆé‹å‹•ï¼‰æ‰èƒ½è®Šå¼·ï¼ˆé•·é«˜ï¼‰ã€‚", category: "é‹å‹•" },
        { id: 5, question: "å¯¶å¯å¤¢çš„ã€Œé€²åŒ–è—¥æ°´ã€ï¼ˆç”Ÿé•·æ¿€ç´ ï¼‰æœƒåœ¨ä»€éº¼æ™‚å€™å¤§é‡ç”Ÿæˆï¼Ÿ", options: ["å‰›èµ·åºŠæ™‚", "æ·±å¤œé€²å…¥ç†Ÿç¡æœŸ", "é£½é¤ä¸€é “å¾Œ", "é‹å‹•çµæŸæ™‚"], answer: "æ·±å¤œé€²å…¥ç†Ÿç¡æœŸ", explanation: "æ·±åº¦ç¡çœ æ˜¯èº«é«”åˆ†æ³Œé€²åŒ–è—¥æ°´çš„é»ƒé‡‘æ™‚é–“ï¼Œåƒè¬ä¸è¦ç†¬å¤œéŒ¯éå–”ï¼", category: "ç”Ÿæ´»" },
        
        // Q6-Q20: é€šç”¨æˆé•·çŸ¥è­˜ï¼Œç”¨èªç¶­æŒè¶£å‘³æ€§
        { id: 6, question: "å“ªç¨®é£Ÿç‰©æ˜¯æä¾›å„ªè³ªè›‹ç™½è³ªï¼Œæœ‰åŠ©æ–¼è‚Œè‚‰èˆ‡èº«é«”çµ„ç¹”ç”Ÿé•·çš„æœ€ä½³ä¾†æºï¼Ÿ", options: ["ç²¾è£½éºµåŒ…", "è±†è…ã€é›è›‹ã€é­šè‚‰", "ç”œé»èˆ‡æœæ±", "è”¬èœæ²¹"], answer: "è±†è…ã€é›è›‹ã€é­šè‚‰", explanation: "è›‹ç™½è³ªæ˜¯èº«é«”æ‰€æœ‰ç´°èƒå’Œè‚Œè‚‰ç”Ÿé•·çš„åŸºç¤ï¼Œå„ªè³ªè›‹ç™½è³ªèƒ½æä¾›èº«é«”æ‰€éœ€çš„å®Œæ•´é¤Šåˆ†ã€‚", category: "ç‡Ÿé¤Š" },
        { id: 7, question: "å“ªç¨®é£²æ–™æœƒå¹²æ“¾èº«é«”å°éˆ£è³ªçš„å¸æ”¶ï¼Œå»ºè­°æ¸›å°‘é£²ç”¨ï¼Ÿ", options: ["ç™½é–‹æ°´", "ç‰›å¥¶", "æ±½æ°´æˆ–å«å’–å•¡å› çš„é£²æ–™", "ç´”æœæ±"], answer: "æ±½æ°´æˆ–å«å’–å•¡å› çš„é£²æ–™", explanation: "é€™äº›é£²å“ä¸­çš„ç‰¹å®šæˆåˆ†å¯èƒ½æœƒå°è‡´éˆ£è³ªæµå¤±ï¼Œå½±éŸ¿éª¨éª¼å¥åº·ï¼Œé˜»ç¤™é€²åŒ–ï¼", category: "ç‡Ÿé¤Š" },
        { id: 8, question: "å¦‚æœä¸æ„›å–ç‰›å¥¶ï¼Œå¯ä»¥å¤šåƒå“ªç¨®é£Ÿç‰©ä¾†è£œå……éˆ£è³ªï¼Ÿ", options: ["é¤…ä¹¾å’Œè›‹ç³•", "æ·±ç¶ è‰²çš„è”¬èœï¼ˆå¦‚èŠ¥è—èœã€è§èœï¼‰", "å·§å…‹åŠ›", "ç™½é£¯"], answer: "æ·±ç¶ è‰²çš„è”¬èœï¼ˆå¦‚èŠ¥è—èœã€è§èœï¼‰", explanation: "è¨±å¤šæ·±ç¶ è‰²è”¬èœå«æœ‰è±å¯Œçš„éˆ£è³ªï¼Œæ˜¯ä¹³è£½å“ä¹‹å¤–çš„å„ªè‰¯é¸æ“‡ï¼Œå°±åƒå¦ä¸€ç¨®é€²åŒ–çŸ³ã€‚", category: "é«˜éˆ£ç‡Ÿé¤Š" },
        { id: 9, question: "åœ¨æˆé•·ç™¼è‚²æœŸï¼Œæ¯å¤©ä¸€å®šè¦è¨˜å¾—è£œå……çš„æ˜¯ä»€éº¼ï¼Ÿ", options: ["å¤§é‡çš„é›¶é£Ÿ", "å……è¶³çš„æ°´åˆ†", "å¤§é‡çš„æ²¹ç‚¸é£Ÿç‰©", "ç¶­ç”Ÿç´  K"], answer: "å……è¶³çš„æ°´åˆ†", explanation: "æ°´æ˜¯èº«é«”é‹è¼¸æ‰€æœ‰ç‡Ÿé¤Šã€é€²è¡Œæ–°é™³ä»£è¬çš„é—œéµï¼Œå°æ‰€æœ‰ç”Ÿç†æ´»å‹•éƒ½éå¸¸é‡è¦ã€‚", category: "ç‡Ÿé¤Š" },
        { id: 10, question: "é•·æœŸè™•æ–¼ç·Šå¼µæˆ–é«˜å£“ç‹€æ…‹ï¼Œå°èº«é«”æˆé•·æœ‰ä»€éº¼å½±éŸ¿ï¼Ÿ", options: ["æ¥µåº¦æœ‰åˆ©ï¼Œèƒ½åˆºæ¿€é¬¥å¿—", "æœ‰å¼Šï¼Œå£“åŠ›æœƒå¹²æ“¾æ­£å¸¸çš„æˆé•·æ©Ÿåˆ¶", "æ²’æœ‰ä»»ä½•å½±éŸ¿", "åªå½±éŸ¿æƒ…ç·’"], answer: "æœ‰å¼Šï¼Œå£“åŠ›æœƒå¹²æ“¾æ­£å¸¸çš„æˆé•·æ©Ÿåˆ¶", explanation: "é•·æœŸçš„å£“åŠ›æœƒè®“èº«é«”åˆ†æ³Œå£“åŠ›è·çˆ¾è’™ï¼Œé€™å¯èƒ½æœƒé–“æ¥å½±éŸ¿èº«é«”çš„è‡ªç„¶æˆé•·é€²åº¦ã€‚", category: "ç”Ÿæ´»" },
        { id: 11, question: "å°æ–¼å…’ç«¥å’Œé’å°‘å¹´ä¾†èªªï¼Œä¸€æ•´å¤©ä¸­å»ºè­°çš„ç¡çœ æ™‚æ•¸æ˜¯ï¼Ÿ", options: ["4-6 å°æ™‚", "9-11 å°æ™‚", "7-8 å°æ™‚", "éš¨æ„å³å¯"], answer: "9-11 å°æ™‚", explanation: "å……è¶³çš„ä¼‘æ¯æ™‚é–“æ‰èƒ½è®“èº«é«”æœ‰è¶³å¤ çš„æ™‚é–“ä¿®å¾©èˆ‡æˆé•·ã€‚", category: "ç”Ÿæ´»" },
        { id: 12, question: "æ™šé¤æ‡‰è©²åœ¨ç¡å‰å¤šä¹…åƒå®Œï¼Œæ‰ä¸æœƒå½±éŸ¿å¤œé–“çš„æˆé•·æ´»å‹•ï¼Ÿ", options: ["ç«‹åˆ»åƒå®Œå°±ç¡", "ç¡å‰ 3-4 å°æ™‚", "ç¡å‰ 1 å°æ™‚", "éš¨æ™‚éƒ½å¯ä»¥"], answer: "ç¡å‰ 3-4 å°æ™‚", explanation: "ç¡å‰è®“è‚šå­æ¶ˆåŒ–å®Œç•¢ï¼Œèº«é«”æ‰èƒ½å°ˆæ³¨æ–¼åˆ†æ³Œæˆé•·æ‰€éœ€çš„ç‰©è³ªã€‚", category: "ç”Ÿæ´»" },
        { id: 13, question: "é‹å‹•å¾Œï¼Œç‚ºäº†å¹«åŠ©è‚Œè‚‰ä¿®å¾©å’Œèº«é«”æˆé•·ï¼Œæ‡‰è©²å„ªå…ˆè£œå……å“ªå…©ç¨®ç‡Ÿé¤Šç´ ï¼Ÿ", options: ["å¤§é‡çš„ç³–æœ", "å¯Œå«è›‹ç™½è³ªå’Œå°‘é‡ç¢³æ°´åŒ–åˆç‰©çš„é£Ÿç‰©", "ç´”è„‚è‚ª", "å’–å•¡"], answer: "å¯Œå«è›‹ç™½è³ªå’Œå°‘é‡ç¢³æ°´åŒ–åˆç‰©çš„é£Ÿç‰©", explanation: "è›‹ç™½è³ªç”¨æ–¼ä¿®å¾©å—æè‚Œè‚‰ï¼Œç¢³æ°´åŒ–åˆç‰©ç”¨æ–¼è£œå……æ¶ˆè€—çš„èƒ½é‡ï¼Œæ˜¯é‹å‹•å¾Œçš„æœ€ä½³çµ„åˆã€‚", category: "é‹å‹•" },
        { id: 14, question: "ä»¥ä¸‹å“ªé …å› ç´ å°æ±ºå®šæœ€çµ‚èº«é«˜å½±éŸ¿æœ€å¤§ï¼Ÿ", options: ["éºå‚³åŸºå› ", "é£²é£Ÿç¿’æ…£", "æ¯å¤©æœ‰æ²’æœ‰å–ç‰›å¥¶", "å‡ºç”Ÿåœ°"], answer: "éºå‚³åŸºå› ", explanation: "åŸºå› æ±ºå®šäº†èº«é«˜çš„æ½›åŠ›ç¯„åœï¼Œä½†å¾Œå¤©çš„ç”Ÿæ´»ç¿’æ…£ï¼ˆç‡Ÿé¤Šã€é‹å‹•ã€ç¡çœ ï¼‰èƒ½æ±ºå®šä½ æ˜¯å¦èƒ½é”åˆ°é€™å€‹æ½›åŠ›ã€‚", category: "çŸ¥è­˜" },
        { id: 15, question: "å“ªç¨®é‹å‹•å°æ”¹å–„é«”æ…‹ã€æ‹‰ä¼¸è„ŠæŸ±æœ€æœ‰åˆ©ï¼Œèƒ½è®“æˆ‘å€‘çœ‹èµ·ä¾†æ›´é«˜æ›´æŒºæ‹”ï¼Ÿ", options: ["é•·æ™‚é–“ååœ¨é›»è…¦å‰", "æ¸¸æ³³æˆ–ä¼¸å±•é‹å‹•ï¼ˆå¦‚ç‘œçˆï¼‰", "èˆ‰é‡", "é›»ç©éŠæˆ²"], answer: "æ¸¸æ³³æˆ–ä¼¸å±•é‹å‹•ï¼ˆå¦‚ç‘œçˆï¼‰", explanation: "é€™äº›é‹å‹•æœ‰åŠ©æ–¼å¼·åŒ–æ ¸å¿ƒï¼Œæ”¹å–„é§èƒŒï¼Œä¿æŒè‰¯å¥½çš„æˆé•·å§¿å‹¢ã€‚", category: "é‹å‹•" },
        { id: 16, question: "ç‚ºäº†é¿å…å› æ›¸åŒ…å£“åŠ›å½±éŸ¿è„Šæ¤ï¼Œæ­£ç¢ºçš„èƒŒè² æ–¹å¼æ˜¯ï¼Ÿ", options: ["å–®è‚©èƒŒè² ", "é›™è‚©èƒŒè² ï¼Œä¸¦èª¿æ•´èƒŒå¸¶ä½¿å…¶ç·Šè²¼èƒŒéƒ¨", "å°‡æ›¸åŒ…æ‹¿åœ¨æ‰‹ä¸Š", "èƒŒå¾ˆé¬†ï¼Œè®“æ›¸åŒ…æ‰åˆ°è…°ä¸‹"], answer: "é›™è‚©èƒŒè² ï¼Œä¸¦èª¿æ•´èƒŒå¸¶ä½¿å…¶ç·Šè²¼èƒŒéƒ¨", explanation: "é€™æ¨£å¯ä»¥å¹³å‡åˆ†æ•£é‡é‡ï¼Œä¿è­·æ­£åœ¨ç™¼è‚²çš„è„Šæ¤ï¼Œé¿å…ä¸è‰¯å§¿å‹¢ã€‚", category: "ç”Ÿæ´»" },
        { id: 17, question: "é•·æœŸç†¬å¤œå°æˆé•·æœ€å¤§çš„è² é¢å½±éŸ¿æ˜¯ä»€éº¼ï¼Ÿ", options: ["é£Ÿæ…¾ä¸æŒ¯", "æ“¾äº‚èº«é«”å¤œé–“åˆ†æ³Œæˆé•·ç‰©è³ªçš„ç¯€å¥", "é«”é‡æ¸›è¼•", "è¨˜æ†¶åŠ›ä¸‹é™"], answer: "æ“¾äº‚èº«é«”å¤œé–“åˆ†æ³Œæˆé•·ç‰©è³ªçš„ç¯€å¥", explanation: "ç†¬å¤œæœƒè®“ä½ åœ¨åˆ†æ³Œé»ƒé‡‘æœŸéŒ¯éæˆé•·æ©Ÿæœƒã€‚", category: "ç”Ÿæ´»" },
        { id: 18, question: "åœ¨æˆé•·ç™¼è‚²æœŸï¼Œæ‡‰ç›¡é‡é¿å…æ”å–éå¤šçš„é£Ÿç‰©é¡å‹æ˜¯ï¼Ÿ", options: ["æ·±ç¶ è‰²è”¬èœ", "é«˜ç³–åˆ†å’Œé«˜æ²¹ç‚¸é£Ÿç‰©", "é©é‡çš„è‚‰é¡", "æ°´"], answer: "é«˜ç³–åˆ†å’Œé«˜æ²¹ç‚¸é£Ÿç‰©", explanation: "é€™äº›é£Ÿç‰©ç¼ºä¹æˆé•·æ‰€éœ€çš„é‡è¦ç‡Ÿé¤Šç´ ï¼Œéåº¦æ”å–æœƒå½±éŸ¿æ•´é«”å¥åº·èˆ‡ç™¼è‚²ã€‚", category: "ç‡Ÿé¤Š" },
        { id: 19, question: "å“ªç¨®è¡Œç‚ºæ¨¡å¼æœ€èƒ½ç¢ºä¿è‰¯å¥½çš„ç¡çœ å“è³ªï¼Ÿ", options: ["ç¡å‰ç©æ‰‹æ©ŸéŠæˆ²", "ç¡å‰é€²è¡ŒåŠ‡çƒˆé‹å‹•", "å»ºç«‹è¦å¾‹çš„ç¡çœ æ™‚é–“è¡¨", "å–å’–å•¡"], answer: "å»ºç«‹è¦å¾‹çš„ç¡çœ æ™‚é–“è¡¨", explanation: "è¦å¾‹çš„ä½œæ¯æœ‰åŠ©æ–¼æ ¡æº–ç”Ÿç†æ™‚é˜ï¼Œè®“èº«é«”åœ¨å›ºå®šçš„æ™‚é–“é€²å…¥æ·±åº¦ç¡çœ ï¼Œåˆ©æ–¼æˆé•·ã€‚", category: "ç”Ÿæ´»" },
        { id: 20, question: "å°æ–¼ä¹³ç³–ä¸è€æˆ–ä¸å–ç‰›å¥¶çš„äººä¾†èªªï¼Œå“ªç¨®é£²å“æ˜¯å¾ˆå¥½çš„éˆ£è³ªæ›¿ä»£ä¾†æºï¼Ÿ", options: ["æ±½æ°´", "é»‘å’–å•¡", "éˆ£å¼·åŒ–è±†æ¼¿æˆ–ç‡•éº¥å¥¶", "ç´”æœæ±"], answer: "éˆ£å¼·åŒ–è±†æ¼¿æˆ–ç‡•éº¥å¥¶", explanation: "é€™äº›æ¤ç‰©å¥¶é€šå¸¸æœƒç¶“éäººå·¥å¼·åŒ–ï¼Œä½¿å…¶éˆ£å«é‡èˆ‡ç‰›å¥¶ç›¸ä¼¼ï¼Œæ˜¯å„ªç§€çš„ã€Œæ›¿ä»£é€²åŒ–çŸ³ã€ã€‚", category: "é«˜éˆ£ç‡Ÿé¤Š" },
    ];

    // --- Tone.js éŸ³æ•ˆè™•ç† ---

    function initTone() {
        if (typeof Tone === 'undefined') {
            console.error("Tone.js å°šæœªè¼‰å…¥ã€‚");
            return;
        }

        // åˆå§‹åŒ–ç­”å°éŸ³æ•ˆåˆæˆå™¨ (ä¸‰è§’å½¢æ³¢)
        state.correctSynth = new Tone.Synth({
            oscillator: { type: "triangle" },
            envelope: { attack: 0.005, decay: 0.1, sustain: 0.0, release: 0.1 }
        }).toDestination();
        
        // åˆå§‹åŒ–ç­”éŒ¯éŸ³æ•ˆåˆæˆå™¨ (æ–¹æ³¢)
        state.wrongSynth = new Tone.Synth({
            oscillator: { type: "square" },
            envelope: { attack: 0.005, decay: 0.1, sustain: 0.0, release: 0.2 }
        }).toDestination();
        
        console.log("Tone.js åˆæˆå™¨åˆå§‹åŒ–æˆåŠŸã€‚");
    }

    function playFeedback(isCorrect) {
        if (!state.correctSynth || !state.wrongSynth || typeof Tone === 'undefined') return;

        // å•Ÿå‹•éŸ³è¨Šä¸Šä¸‹æ–‡ (æ¯æ¬¡ä½¿ç”¨è€…äº’å‹•æ™‚éƒ½æª¢æŸ¥ä¸¦å˜—è©¦å•Ÿå‹•)
        if (Tone.context.state !== 'running') {
            Tone.start().catch(err => console.error("ç„¡æ³•å•Ÿå‹•éŸ³è¨Šä¸Šä¸‹æ–‡:", err));
        }

        if (isCorrect) {
            // ç­”å°éŸ³æ•ˆï¼šC5, E5, G5 ä¸Šè¡Œä¸‰å’Œå¼¦ (Evolution Sound!)
            state.correctSynth.triggerAttackRelease("C5", "8n");
            state.correctSynth.triggerAttackRelease("E5", "8n", Tone.now() + 0.05);
            state.correctSynth.triggerAttackRelease("G5", "8n", Tone.now() + 0.1);
        } else {
            // ç­”éŒ¯éŸ³æ•ˆï¼šC3, B2 ä¸‹è¡ŒéŸ³ (Missed Attack)
            state.wrongSynth.triggerAttackRelease("C3", "16n");
            state.wrongSynth.triggerAttackRelease("B2", "16n", Tone.now() + 0.1);
        }
    }

    // --- éŠæˆ²æµç¨‹æ§åˆ¶ ---

    function startTimer() {
        if (state.intervalId) {
            clearInterval(state.intervalId);
        }
        state.intervalId = setInterval(() => {
            state.timer++;
            render(); // æ›´æ–°è¨ˆæ™‚å™¨é¡¯ç¤º
        }, 1000);
    }

    function stopTimer() {
        if (state.intervalId) {
            clearInterval(state.intervalId);
            state.intervalId = null;
        }
    }

    function startQuiz() {
        stopTimer();
        
        // éš¨æ©Ÿé¸é¡Œ
        const shuffled = [...quizData].sort(() => 0.5 - Math.random());
        state.currentQuestions = shuffled.slice(0, state.NUM_QUESTIONS);
        
        // é‡è¨­ç‹€æ…‹
        state.currentQIndex = 0;
        state.score = 0;
        state.timer = 0;
        state.selectedAnswer = null;
        state.isCorrect = null;
        state.gameState = 'playing';

        // å˜—è©¦å•Ÿå‹•éŸ³è¨Šä¸Šä¸‹æ–‡
        if (typeof Tone !== 'undefined' && Tone.context.state !== 'running') {
            Tone.start().catch(err => console.error("ç„¡æ³•å•Ÿå‹•éŸ³è¨Šä¸Šä¸‹æ–‡:", err));
        }
        startTimer();
        
        render();
    }

    function handleAnswerSelect(answer) {
        if (state.gameState !== 'playing') return;

        // æ›¿æ› ' (å–®å¼•è™Ÿ) ç¢ºä¿èˆ‡ onclick å‚³å…¥çš„å­—ä¸²åŒ¹é…
        const safeAnswer = answer.replace(/\\'/g, "'"); 
        
        const currentQ = state.currentQuestions[state.currentQIndex];
        const correct = safeAnswer === currentQ.answer;

        state.selectedAnswer = safeAnswer;
        state.isCorrect = correct;
        state.gameState = 'answer';

        playFeedback(correct);

        if (correct) {
            state.score++;
        }

        render();
    }

    function nextQuestion() {
        if (state.currentQIndex < state.NUM_QUESTIONS - 1) {
            state.currentQIndex++;
            state.selectedAnswer = null;
            state.isCorrect = null;
            state.gameState = 'playing';
        } else {
            stopTimer();
            state.gameState = 'end';
        }
        render();
    }
    
    // --- æ¸²æŸ“ç•«é¢å‡½å¼ ---

    function getStartScreenHtml() {
        return `
            <div class="bg-white p-8 md:p-12 rounded-3xl shadow-[0_0_60px_rgba(59,130,246,0.7)] text-center max-w-md w-full border-b-8 border-blue-500">
                <h1 class="text-5xl font-black text-blue-600 mb-2 tracking-wider flex items-center justify-center">
                    <span class="text-6xl mr-2">ğŸŒŸ</span> å¯¶å¯å¤¢é€²åŒ–æŒ‘æˆ°
                </h1>
                <p class="text-gray-600 text-lg mb-6 font-bold">
                    æˆ‘æ˜¯é€²åŒ–å¤§ä½¿ï¼Œè€ƒè€ƒä½ å°ã€Œé€²åŒ–ã€çš„çŸ¥è­˜ï¼
                </p>
                <div class="bg-yellow-50 p-4 rounded-xl border-4 border-yellow-400 mb-8 text-left shadow-inner">
                    <p class="text-gray-700 font-extrabold mb-1 flex items-center">
                        <span class="text-2xl mr-2">ğŸ’¡</span> è¨“ç·´å¸«ä»»å‹™:
                    </p>
                    <ul class="text-sm text-gray-600 list-disc list-inside space-y-1 ml-4">
                        <li>ç¸½å…±æœ‰ ${state.NUM_QUESTIONS} å€‹ã€Œé€²åŒ–ç§˜è¨£ã€æŒ‘æˆ°ã€‚</li>
                        <li>ç­”å°å¯ä»¥å¾—åˆ°ã€Œé€²åŒ–çŸ³ç¢ç‰‡ã€ï¼</li>
                        <li>é›†æ»¿çŸ¥è­˜ï¼Œè®“èº«é«”æˆåŠŸã€Œé€²åŒ–ã€æˆæœ€å¥åº·å‹æ…‹ï¼</li>
                    </ul>
                </div>
                <button
                    onclick="startQuiz()"
                    class="w-full bg-red-600 hover:bg-red-700 text-white text-2xl font-black py-4 rounded-xl shadow-[0_5px_20px_rgba(239,68,68,0.6)] transition transform hover:scale-[1.02] active:scale-[0.98]"
                >
                    é–‹å§‹ç‰¹è¨“ï¼ (Start)
                </button>
            </div>
        `;
    }

    function getQuizScreenHtml() {
        const currentQ = state.currentQuestions[state.currentQIndex];
        const isAnswered = state.gameState === 'answer';
        const progressPercent = ((state.currentQIndex + 1) / state.NUM_QUESTIONS) * 100;
        
        let optionsHtml = currentQ.options.map((option, index) => {
            let buttonClasses = "w-full text-left py-4 px-5 border-4 rounded-xl text-lg font-bold transition duration-300 shadow-lg flex items-center";
            let isSelected = state.selectedAnswer === option;

            if (isAnswered) {
                if (option === currentQ.answer) {
                    buttonClasses += " bg-green-500 border-green-700 text-white shadow-green-400/80 transform scale-[1.01]";
                } else if (isSelected) {
                    buttonClasses += " bg-red-500 border-red-700 text-white shadow-red-400/80 line-through opacity-70";
                } else {
                    buttonClasses += " bg-gray-100 border-gray-300 text-gray-500";
                }
            } else {
                buttonClasses += " bg-white border-blue-400 text-gray-800 hover:bg-blue-50 active:scale-[0.99] hover:shadow-blue-300/50";
            }
            
            // å°é¸é …å­—ä¸²é€²è¡Œè½‰ç¾©ï¼Œç¢ºä¿ onclick ä¸­çš„å–®å¼•è™Ÿä¸æœƒä¸­æ–·å­—ä¸²
            const safeOption = option.replace(/'/g, "\\'"); 

            return `
                <button
                    class="${buttonClasses}"
                    onclick="handleAnswerSelect('${safeOption}')"
                    ${isAnswered ? 'disabled' : ''}
                >
                    <span class="mr-3 font-mono text-xl">${String.fromCharCode(65 + index)}.</span>
                    ${option}
                </button>
            `;
        }).join('');
        
        let feedbackHtml = '';
        if (isAnswered) {
            const feedbackClass = state.isCorrect ? 'bg-green-100 border-green-600' : 'bg-red-100 border-red-600';
            const feedbackText = state.isCorrect ? 'âœ… å®Œç¾å‘½ä¸­ï¼ç²å¾—é€²åŒ–çŸ³ç¢ç‰‡ï¼' : 'âŒ æ²’é—œä¿‚ï¼Œé€™æ¬¡æ”»æ“Šè½ç©ºäº†ï¼';
            const nextButtonText = state.currentQIndex < state.NUM_QUESTIONS - 1 ? 'ä¸‹ä¸€å›åˆ >>' : 'æŸ¥çœ‹æœ€çµ‚é€²åŒ–çµæœ >>';

            feedbackHtml = `
                <div class="mt-8">
                    <div class="p-5 rounded-xl border-l-8 ${feedbackClass} mb-6 shadow-md">
                        <p class="font-extrabold text-xl mb-2 flex items-center text-gray-800">
                            ${feedbackText}
                        </p>
                        <p class="text-sm text-gray-700">
                            **è¨“ç·´å¸«ç§˜è¨£:** ${currentQ.explanation}
                        </p>
                    </div>
                    
                    <button
                        onclick="nextQuestion()"
                        class="w-full bg-yellow-500 hover:bg-yellow-600 text-gray-900 text-xl font-black py-4 rounded-xl shadow-[0_5px_15px_rgba(255,215,0,0.5)] transition duration-300 transform active:scale-[0.98]"
                    >
                        ${nextButtonText}
                    </button>
                </div>
            `;
        }

        return `
            <div class="bg-white shadow-[0_0_50px_rgba(59,130,246,0.5)] rounded-3xl w-full max-w-xl p-6 md:p-10 border-t-8 border-blue-500">
                
                <!-- é ‚éƒ¨è³‡è¨Šæ¬„ -->
                <div class="mb-6 flex justify-between items-center text-gray-700 bg-red-50 p-3 rounded-xl border-2 border-red-200">
                    <span class="text-xl font-black text-red-600 flex items-center">
                        <span class="text-3xl mr-2">âš”ï¸</span> æŒ‘æˆ° ${state.currentQIndex + 1} / ${state.NUM_QUESTIONS}
                    </span>
                    <span class="text-lg font-mono bg-blue-500 text-white px-3 py-1 rounded-full shadow-lg">
                        â±ï¸ ${state.timer}s
                    </span>
                    <span class="text-xl font-black text-yellow-600 flex items-center">
                        <span class="text-3xl mr-1">ğŸ’</span> ç¢ç‰‡: ${state.score}
                    </span>
                </div>

                <!-- é€²åº¦æ¢ -->
                <div class="w-full bg-gray-200 rounded-full h-3 mb-8">
                    <div 
                        class="bg-green-500 h-3 rounded-full transition-all duration-500 shadow-md shadow-green-300" 
                        style="width: ${progressPercent}%;">
                    </div>
                </div>

                <!-- å•é¡Œå€ -->
                <h2 class="text-2xl font-extrabold mb-8 text-gray-900 border-l-4 border-yellow-500 pl-4 leading-relaxed bg-yellow-50 p-4 rounded-lg shadow-inner">
                    ${currentQ.question}
                </h2>

                <!-- é¸é …å€ -->
                <div class="space-y-4 mb-8">
                    ${optionsHtml}
                </div>

                <!-- ç­”æ¡ˆè§£æèˆ‡ä¸‹ä¸€é¡ŒæŒ‰éˆ• -->
                ${feedbackHtml}
            </div>
        `;
    }

    function getEndScreenHtml() {
        const score = state.score;
        const total = state.NUM_QUESTIONS;
        const time = state.timer;
        const percentage = ((score / total) * 100).toFixed(0);
        let message, rating, color;

        if (score === total) {
            rating = "ğŸ† æ­å–œé€²åŒ–ï¼ (Master Trainer)";
            message = "ğŸ‰ ä½ çš„å¯¶å¯å¤¢å·²å®Œå…¨é€²åŒ–ï¼ä½ æŒæ¡äº†æ‰€æœ‰å¥åº·æˆé•·çš„çŸ¥è­˜ï¼";
            color = "text-yellow-500 border-yellow-500";
        } else if (score >= total * 0.8) {
            rating = "ğŸ–ï¸ æº–é€²åŒ–å¤§å¸« (Elite Trainer)";
            message = "ğŸ‘ è¡¨ç¾å„ªç•°ï¼åªéœ€ä¸€é»é»è¨“ç·´ï¼Œå°±èƒ½å®Œå…¨é€²åŒ–ï¼";
            color = "text-green-500 border-green-500";
        } else if (score >= total * 0.6) {
            rating = "ğŸŒŸ èªçœŸè¨“ç·´å¸« (Dedicated Trainer)";
            message = "ğŸ™‚ è¡¨ç¾ä¸éŒ¯ï¼è«‹ç¹¼çºŒå°ˆæ³¨æ–¼ç‡Ÿé¤Šèˆ‡é‹å‹•çš„ç‰¹è¨“ï¼";
            color = "text-blue-500 border-blue-500";
        } else {
            rating = "ğŸŒ± èœé³¥è¨“ç·´å¸« (Rookie)";
            message = "ğŸ¤” æ²’é—œä¿‚ï¼Œå¤šè¤‡ç¿’å¹¾æ¬¡é€²åŒ–ç§˜è¨£ï¼Œä¸‹æ¬¡ä¸€å®šèƒ½æˆåŠŸï¼";
            color = "text-red-500 border-red-500";
        }

        return `
            <div class="bg-white p-8 md:p-12 rounded-3xl shadow-[0_0_50px_rgba(255,0,0,0.5)] text-center max-w-md w-full border-t-8 border-red-500">
                <div class="text-6xl mb-4">${score === total ? 'ğŸ¥‡' : 'ğŸ‰'}</div>
                <h2 class="text-3xl font-black text-gray-800 mb-4">é€²åŒ–æŒ‘æˆ°å ±å‘Š</h2>
                
                <p class="text-2xl font-extrabold mb-6 ${color} p-2 border-b-4">${rating}</p>

                <div class="bg-gray-100 p-6 rounded-xl space-y-3 mb-8 border border-gray-300 shadow-inner">
                    <p class="text-xl font-bold text-gray-700">ç²å¾—ç¢ç‰‡: <span class="text-green-600 text-2xl">${score} / ${total}</span></p>
                    <p class="text-4xl font-extrabold text-blue-700">é€²åŒ–åº¦: ${percentage}%</p>
                    <p class="text-sm text-gray-500">ç¸½è¨“ç·´æ™‚é–“: ${time} ç§’</p>
                </div>
                
                <p class="text-lg text-gray-700 mb-8 font-medium">${message}</p>

                <button
                    onclick="startQuiz()"
                    class="w-full bg-yellow-500 hover:bg-yellow-600 text-gray-900 text-xl font-black py-3 rounded-xl shadow-lg transition transform active:scale-[0.98]"
                >
                    å†ç‰¹è¨“ä¸€æ¬¡ï¼ (æ–°å›åˆ)
                </button>
            </div>
        `;
    }

    function render() {
        const appContainer = document.getElementById('app');
        if (!appContainer) return;

        let content = '';
        switch (state.gameState) {
            case 'start':
                content = getStartScreenHtml();
                break;
            case 'playing':
            case 'answer':
                content = getQuizScreenHtml();
                break;
            case 'end':
                content = getEndScreenHtml();
                break;
            default:
                content = getStartScreenHtml();
        }
        
        // å°‡å…§å®¹åŒ…è£¹åœ¨ä¸»ä½ˆå±€å®¹å™¨ä¸­
        appContainer.innerHTML = `
            <div class="min-h-screen bg-gray-900 p-4 flex items-center justify-center font-sans">
                ${content}
            </div>
        `;
    }

    // é é¢åŠ è¼‰å®Œæˆå¾ŒåŸ·è¡Œåˆå§‹åŒ–
    window.onload = function() {
        // å»¶é²åˆå§‹åŒ– Tone.js ä»¥ç¢ºä¿ CDN è¼‰å…¥å®Œæˆ
        setTimeout(() => {
            initTone();
            render(); // åˆå§‹æ¸²æŸ“
        }, 100); 
    };
</script>

</body>
</html>